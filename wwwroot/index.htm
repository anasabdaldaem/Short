<!doctype html>
<html>

<head>
    <title>Simple URL Shortener</title>
    <style>
        :root{--border-radius:5px;--box-shadow:2px 2px 10px;--color:#118bee;--color-accent:#118bee15;--color-bg:#fff;--color-bg-secondary:#e9e9e9;--color-secondary:#920de9;--color-secondary-accent:#920de90b;--color-shadow:#f4f4f4;--color-text:#000;--color-text-secondary:#999;--font-family:0 BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;--hover-brightness:1.2;--justify-important:center;--justify-normal:left;--line-height:1.5;--width-card:285px;--width-card-medium:460px;--width-card-wide:800px;--width-content:100%;}article aside{background:var(--color-secondary-accent);border-left:4px solid var(--color-secondary);padding:.01rem .8rem;}body{background:var(--color-bg);color:var(--color-text);font-family:var(--font-family);line-height:var(--line-height);overflow-x:hidden;margin:0;padding:1rem 0;}footer,header,main{max-width:var(--width-content);margin:0 auto;padding:2rem 1rem;}hr{background-color:var(--color-bg-secondary);border:none;height:1px;margin:4rem 0;}section{display:flex;flex-wrap:wrap;justify-content:var(--justify-important);}section aside{border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);box-shadow:var(--box-shadow) var(--color-shadow);width:var(--width-card);margin:1rem;padding:1.25rem;}section aside:hover{box-shadow:var(--box-shadow) var(--color-bg-secondary);}[hidden]{display:none;}article header,div header,main header{padding-top:0;}header{text-align:var(--justify-important);}header a b,header a em,header a i,header a strong{margin-left:.5rem;margin-right:.5rem;}header nav img{margin:1rem 0;}section header{padding-top:0;width:100%;}nav{align-items:center;display:flex;font-weight:700;justify-content:space-between;margin-bottom:7rem;}nav ul{list-style:none;padding:0;}nav ul li{display:inline-block;position:relative;text-align:left;margin:0 .5rem;}nav ul li ul{background:var(--color-bg);border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);box-shadow:var(--box-shadow) var(--color-shadow);display:none;height:auto;left:-2px;position:absolute;top:1.7rem;white-space:nowrap;width:auto;z-index:1;padding:.5rem 1rem;}nav ul li ul::before{content:"";position:absolute;left:0;right:0;top:-.5rem;height:.5rem;}code,samp{background-color:var(--color-accent);border-radius:var(--border-radius);color:var(--color-text);display:inline-block;margin:0 .1rem;padding:0 .5rem;}details{margin:1.3rem 0;}details summary{font-weight:700;cursor:pointer;}h1,h2,h3,h4,h5,h6{line-height:var(--line-height);}mark{padding:.1rem;}ol li,ul li{padding:.2rem 0;}p{margin:.75rem 0;padding:0;}pre{max-width:var(--width-card-wide);margin:1rem 0;padding:1rem 0;}pre code,pre samp{display:block;max-width:var(--width-card-wide);white-space:pre-wrap;padding:.5rem 2rem;}sup{background-color:var(--color-secondary);border-radius:var(--border-radius);color:var(--color-bg);font-size:xx-small;font-weight:700;position:relative;top:-2px;margin:.2rem;padding:.2rem .3rem;}a{color:var(--color-secondary);display:inline-block;font-weight:700;text-decoration:none;}a:hover{filter:brightness(var(--hover-brightness));text-decoration:underline;}a b,a em,a i,a strong,button,#btn{border-radius:var(--border-radius);display:inline-block;font-size:medium;font-weight:700;line-height:var(--line-height);margin:.5rem 0;padding:1rem 2rem;}button,#btn{font-family:var(--font-family);}button:hover,#btn:hover{cursor:pointer;filter:brightness(var(--hover-brightness));}a b,a strong,button,#btn{background-color:var(--color);border:2px solid var(--color);color:var(--color-bg);}a em,a i{border:2px solid var(--color);border-radius:var(--border-radius);color:var(--color);display:inline-block;padding:1rem 2rem;}figure{margin:0;padding:0;}button:disabled,input:disabled{background:var(--color-bg-secondary);color:var(--color-text-secondary);cursor:not-allowed;border-color:var(--color-bg-secondary);}button[disabled]:hover{filter:none;}form{border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);box-shadow:var(--box-shadow) var(--color-shadow);display:block;max-width:var(--width-card-wide);min-width:var(--width-card);text-align:var(--justify-normal);padding:1.5rem;}form header{margin:1.5rem 0;padding:1.5rem 0;}input,label,select,textarea{display:block;font-size:inherit;max-width:var(--width-card-wide);}input[type="checkbox"],input[type="radio"]{display:inline-block;}input[type="checkbox"]+label,input[type="radio"]+label{display:inline-block;font-weight:400;position:relative;top:1px;}input,select,textarea{border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);margin-bottom:1rem;padding:.4rem .8rem;}input[readonly],textarea[readonly]{background-color:var(--color-bg-secondary);}label{font-weight:700;margin-bottom:.2rem;}table{border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);border-spacing:0;display:inline-block;max-width:100%;overflow-x:auto;white-space:nowrap;padding:0;}table td,table th,table tr{text-align:var(--justify-important);padding:.4rem .8rem;}table thead{background-color:var(--color);border-collapse:collapse;border-radius:var(--border-radius);color:var(--color-bg);margin:0;padding:0;}table thead th:first-child{border-top-left-radius:var(--border-radius);}table thead th:last-child{border-top-right-radius:var(--border-radius);}table thead th:first-child,table tr td:first-child{text-align:var(--justify-normal);}table tr:nth-child(even){background-color:var(--color-accent);}blockquote{display:block;font-size:x-large;line-height:var(--line-height);max-width:var(--width-card-medium);text-align:var(--justify-important);margin:1rem auto;padding:1.5rem 1rem;}blockquote footer{color:var(--color-text-secondary);display:block;font-size:small;line-height:var(--line-height);padding:1.5rem 0;}section aside img,figure img{max-width:100%;}nav ul li:hover ul,nav ul li ul li,nav ul li ul li a{display:block;}small,figure figcaption{color:var(--color-text-secondary);}
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://github.com/anasabdaldaem/hello-world/blob/master/aes.js" type="text/javascript"></script>
    <script type="text/javascript">  
  
    function Click(){
        debugger;  
            var txtUserName = document.getElementById("user").value.trim();  
            var txtpassword = document.getElementById("password").value.trim();  
  
            if (txtUserName == "") {  
                alert('Please enter UserName');  
                return false;  
            }  
            else if (txtpassword == "") {  
                alert('Please enter Password');  
                return false;  
            }  
            else {  
                var key = CryptoJS.enc.Utf8.parse('E@q:7tiO`_Z!1$SQ');
                var iv = CryptoJS.enc.Utf8.parse('oklJ-}$Z@pkc7fFE');
                var encryptedlogin = CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(txtUserName), key,  
                {  
                    keySize: 128 / 8,  
                    iv: iv,  
                    mode: CryptoJS.mode.CBC,  
                    padding: CryptoJS.pad.Pkcs7  
                });
                var encryptedpassword = CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(txtpassword), key,  
                {  
                    keySize: 128 / 8,  
                    iv: iv,  
                    mode: CryptoJS.mode.CBC,  
                    padding: CryptoJS.pad.Pkcs7  
                });  

            }  
        var url = "/ViewAll?user="+encryptedlogin+"&password="+encryptedpassword;

        // send AJAX request 
        var req = new XMLHttpRequest();
        req.onload = function () {
           
            generateHTMLTable(JSON.parse(req.response));
        }
        console.log(generateHTMLTable);
        req.open("GET", url);
        req.send();

        // generate HTML string and insert it 
        function generateHTMLTable(data) {
            var str = "";
            console.log(data)
            data.forEach(Object => {
                str += "<tr>"; // open HTML row 
                str += "<td>" + Object.user + "</td>";
                str += "<td>" + Object.id + "</td>";
                str += "<td>" + Object.url + "</td>";
                str += "<td>" +"/"+Object.user+"/"+Object.chunk + "</td>";
                str += "<td>" + Object.count + "</td>";
                str += "<td>" + Object.create + "</td>";
                str += "<td>" + Object.lastacc + "</td>";
                str += "</tr>";
            });
            

            // assumes the table element has id "table": 
            // <table id="table"></table> 
            var table = document.getElementById("table");
            table.innerHTML += str;}
        } 
    </script>
</head>

<body>
    <main>
        <header>
            <h1>Simple URL Shortener</h1>
            <p>
                Enter your URL below to retrieve the shortened version.
            </p>
        </header>
        <section id="urlForm">
            <form id="f1" enctype="application/x-www-form-urlencoded" method="POST">
                <label for="url">
                    Your USERNAME
                </label>
                <input type="text" name="user" id="user"/>
                <label for="url">
                    Your PASSWORD
                </label>
                <input type="password" name="password" id="password"/>
                <label for="url">
                    URL To Shorten
                </label>
                <input type="url" name="url" />
                <label for="url">
                    ShortCode You Need
                </label>
                <input type="url" name="shortcode" />
                <button type="submit" formaction="/shorten">Shorten</button>
                <button type="submit" formaction="/Find">Find</button>
                <button id="btn" type="button" onclick="Click()">View ALL ShortLinks</button>
                <button type="submit" formaction="/Signup">SignUp</button>
                <p id="urlResult">

                </p>
            </form>
            <br>
        </section>
        <section>
            <table id="table">
                <tr>
                    <td>
                        USERNAME
                    </td>
                    <td>
                        ID
                    </td>
                    <td>
                        URL
                    </td>
                    <td>
                        chunk
                    </td>
                    <td>
                        Count of Visit
                    </td>
                    <td>
                        Creat Date
                    </td>
                    <td>
                        Last Access
                    </td>
                </tr>
            </table>
        </section>
    </main>
    <script>
        let data = window.location.hash;
        if (data) {

            let url = new URL(data.substr(1));

            if (url.protocol === window.location.protocol
                && url.host === window.location.host) {
                let section = document.getElementById('urlResult');
                section.innerHTML = `<a id="link" href="${url}">${url}</a>`;
            }
        }

    </script>
</body>

</html>